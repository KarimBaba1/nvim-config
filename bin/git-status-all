#!/usr/bin/env bash
# set -x

echo "Projects with changes:"
echo

if [[ ! -f ~/.open-project.cache ]]; then
  fdfind -H "^project.vim" $HOME | sed -e 's|/\.devbase.*||' -e 's|/project.vim||' -e "s|$HOME/||" > ~/.open-project.cache
fi
projs="$(cat ~/.open-project.cache)"

for base in $projs; do
  if [[ -d $base/.git ]]; then
    status=`git -C $HOME/$base status --porcelain`
    commits=`git -C $HOME/$base cherry -v 2>/dev/null`

    if [[ "$status" != "" ]]; then
      echo "$base (Uncommited changes)"
    elif [[ "$commits" != "" ]]; then
      echo "$base (Unpushed commits)"
    fi
  fi
done
